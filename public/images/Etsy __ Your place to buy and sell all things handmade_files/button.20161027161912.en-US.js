/*!
 *  hogan.js version: 3.0.0
 *
 *  Copyright 2011 Twitter, Inc.
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */

/**
 * @license RequireJS text 2.0.12 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/**@license
 * RequireJS Hogan Plugin | v0.3.0 (2013/06/11)
 * Author: Miller Medeiros | MIT License
 *
 */

//     (c) 2010-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

define("collections/models/Listing",[],function(){var t=Etsy.Backbone.Model.extend({modelName:"listings",idField:"listing_id",idAttribute:"listing_id",defaults:{is_fetching:!1},url:function(){return Etsy.Backbone.API_URL+this.getCollectionBasePath()+this.modelName+"/"+this.getId()},getCollectionBasePath:function(){var t=this.get("collection"),e=t.modelName+"/",i=t.get("type");return"collection"!==i&&"favorites"!==i&&(e+=i+"/"),e+=t.getId()+"/"},isNew:function(){return this.get("deleting")?!1:!0}});return t}),require.config({paths:{"collections/models/Listing":"collections/models/Listing.20161027161911"}}),define("collections/models/ListingCollection",["collections/models/Listing"],function(t){var e=Etsy.Backbone.Collection.extend({model:t,collectionName:"listings",initialize:function(t){this.collectionKey=t.collectionKey,this.collectionId=t.collection_id,t&&t.fetch&&this.fetch()},url:function(){return Etsy.Backbone.API_URL+"collections/"+this.collectionKey+"/"+this.collectionName}});return e}),require.config({paths:{"collections/models/Listing":"collections/models/Listing.20161027161911","collections/models/ListingCollection":"collections/models/ListingCollection.20161027161911"}}),define("collections/models/Collection",["jquery","collections/models/Listing","collections/models/ListingCollection"],function(t,e,i){var n=Etsy.Backbone.Model.extend({modelName:"collections",idField:"key",url:function(){var t=Etsy.Backbone.API_URL+this.modelName,e=this.get("type");if(e&&"page_collection"==e){t=Etsy.Backbone.API_URL+"pages/"+this.get("creator_id")+"/"+this.modelName;var i=this.get("id");return"undefined"!=typeof i&&(t+="/"+i),t}var i=this.getId();return"undefined"!=typeof i?t+"/"+i:t},addListing:function(i,n){var s=new e({listing_id:i,collection:this}),o={listing_id:i,collection_type:this.get("type")};n&&n.attributee_id&&(o.attributee_id=n.attributee_id),this.get("is_registry")&&Etsy.Context.data.registry_attr&&(o.registry_attr=Etsy.Context.data.registry_attr),s.save(o,{success:_.bind(function(e,o){o.facebook&&o.facebook.listing_shared&&this.logFacebookShareEvent(i,"facebook_favorite_listing"),"favorites"==this.get("type")&&t(document).trigger("etsy:favorite:add",[e.toJSON(),o]),"collection"==this.get("type")&&t(document).trigger("etsy:collect:add",[e.toJSON(),o]),this.getListings().add(s),this.trigger("listing-added",i,o),s.trigger("sync",this,o),n&&n.success&&n.success.apply(this,arguments)},this),error:_.bind(function(t,e){this.trigger("sync",this,e),n&&n.error&&n.error.apply(this,arguments)},this)})},initialize:function(){if(this.on("listing-added",this.listingAdded,this),this.on("listing-removed",this.listingRemoved,this),this.listing_index={},Etsy.Context.data.listings_to_collections||this.collection&&this.collection.listingsMap&&this.collection.listingsMap.map){var t=Etsy.Context.data.listings_to_collections;this.collection&&this.collection.listingsMap&&this.collection.listingsMap.map&&(t=this.collection.listingsMap.map),this.updateListingIndex(t)}else this.updateListingIndex();this.collection&&this.collection.listingsMap&&this.collection.listingsMap.on("sync",function(t){this.updateListingIndex(t)},this)},listingAdded:function(t){this.listing_index[t]=!0,this.trigger("sync")},listingRemoved:function(t){delete this.listing_index[t],this.trigger("sync")},updateListingIndex:function(t){this.getListings().each(function(t){t.get("listing_id")&&(this.listing_index[t.get("listing_id")]=!0)},this),t&&_(t).each(function(t,e){_(t).each(function(t){t==this.get("key")&&(this.listing_index[e]=!0)},this)},this),this.trigger("sync")},removeListing:function(t){var i,n=this.getListings().where({listing_id:t});i=0==n.length?new e({listing_id:t,collection:this,collection_type:this.get("type")}):n[0],i.set("deleting",!0),i.set("collection_type",this.get("collection_type"));var s=this;i.destroy({success:function(e,n){s.trigger("listing-removed",t),i.trigger("sync",this,n),!s.get("is_registry")&&n.facebook&&n.facebook.listing_shared&&s.logFacebookShareEvent(t,"facebook_unfavorite_listing")},error:function(){console.error("Error")}})},containsListing:function(t){return t in this.listing_index},parse:function(t){var e=Etsy.Backbone.Model.prototype.parse.call(this,t);this.collectionKey=e.key,this.collectionId=e.collection_id;var i=this;if(e.listing_ids){var n=[];_.each(e.listing_ids,function(t){n.push({listing_id:parseInt(t),collection:i})}),this.getListings().reset(n)}return e},getListings:function(){return this.listings||(this.listings=new i({collectionKey:this.collectionKey,collectionId:this.collectionId})),this.listings},defaults:{is_fetching:!1},validate:function(t){var e=[];return 0==t.name.length&&e.push({message:"Your list must have a name."}),this.collection&&t.name.length>0&&this.collection.filter(function(e){return e.get("name")==t.name&&e.get("key")!=this.get("key")},this).length>0&&e.push({message:"You already have a list named "+t.name+"."}),e.length>0?e:void 0},logFacebookShareEvent:function(t,e){var i={php_event_name:e,user_id:Etsy.getSignedInUserId(),listing_id:t};Etsy.EventLogger.logEvent(i)}});return n}),require.config({paths:{"collections/models/Collection":"collections/models/Collection.20161027161911"}}),define("collections/models/CollectionCollection",["jquery","collections/models/Collection"],function(t,e){var i=Etsy.Backbone.Collection.extend({model:e,initialize:function(t){this.userId=t.userId,this.listingsMap=t.listingsMap,this.fetch()},comparator:function(e,i){if(e.get("is_favorites"))return-1;if(i.get("is_favorites"))return 1;if(!e.get("name"))return 1;if(!i.get("name"))return-1;var n=t("<div/>").html(e.get("name")).text(),s=t("<div/>").html(i.get("name")).text();return n.toLowerCase().localeCompare(s.toLowerCase())},url:function(){return Etsy.Backbone.API_URL+this.collectionName+"?user_id="+this.userId},collectionName:"collections"});return i}),define("collections/views/CollectionList",["jquery"],function(t){var e=Backbone.View.extend({tagName:"li",className:"collection",render:function(){if(!this.htmlRendered){var e={name:t("<div>").html(this.model.get("name")).text()};this.$el.html(this.template(e)),this.htmlRendered=!0}return this.$el.removeClass("loading"),this.model.containsListing(this.options.listing_id)?this.$el.addClass("active"):this.$el.removeClass("active"),this},events:{click:"toggleCollectListing"},listingAdded:function(t,e){this.model.get("is_registry")&&Etsy.RegistryBar&&Etsy.RegistryBar.show(e.results),this.render()},listingRemoved:function(){this.model.get("is_registry")&&Etsy.RegistryBar&&Etsy.RegistryBar.hide(),this.render()},initialize:function(){this.model.on("listing-removed",this.listingRemoved,this),this.model.on("listing-added",this.listingAdded,this),this.model.on("sync",this.render,this);var e=t("#collections-list-tpl");this.template=e.length>0?Etsy.template(e.html()):function(){},this.$el.addClass(this.model.get("privacy_level")+"-list"),this.model.get("is_registry")&&this.$el.addClass("registry-list")},toggleCollectListing:function(){var e;this.options.parent.trigger("loading"),this.$el.addClass("loading"),this.model.containsListing(this.options.listing_id)?(this.model.removeListing(this.options.listing_id),e=!1):(this.model.addListing(this.options.listing_id,{error:_.bind(function(e,i){var n=t.parseJSON(i.responseText);if(n&&n.errors&&n.errors[0]){var s=n.errors[0],o="";_(s).each(function(t){o+=t.join(" ")}),alert(o)}},this)}),e=!0),this.options.parent.logListingEvent(this.options.listing_id,this.model,e)}});return e}),require.config({paths:{"collections/views/CollectionList":"collections/views/CollectionList.20161027161911"}}),define("collections/views/SharedChooser",["jquery","collections/views/CollectionList"],function(t,e){var i=13,n=Backbone.View.extend({initialize:function(){this.collection_list=this.$(".list-main"),this.aux_list=this.$(".list-aux"),this.aux_container=this.$(".aux-collections"),this.parent_view=null,this.$(".user-collections a").prop("href","/people/"+Etsy.getSignedInLoginName()+"/favorites?ref=list_btn")},alignStandard:function(){this.$el.removeClass("right-aligned")},alignRight:function(){this.$el.addClass("right-aligned")},getElRightPosition:function(t){return t.offset().left+t.width()},adjustAlignment:function(e){var i=this.getElRightPosition(this.$el),n=e&&e.length?this.getElRightPosition(e):t(window).width();i>n?this.alignRight():this.alignStandard()},events:{"click .new-collections input.text":"activateAddCollection","keyup .new-collections input.text":"addCollectionKeyUp","click .new-collections button":"handleAddCollection"},activateAddCollection:function(){this.$el.find(".new-collections").addClass("activated")},addCollectionKeyUp:function(t){t.which===i&&this.handleAddCollection(t)},handleAddCollection:function(e){e.preventDefault();var i=this.$("input[type=text]").val();i=t.trim(i),this.parent_view.createCollectionAndAddListing(i),this.$(".new-collections").addClass("hide"),this.collection_list.append(Etsy.template('<li class="collection loading shim"><span class="icon"></span><span class="collection-name"> <%+ name %></span>',{name:i}))},setParent:function(t){this.parent_view=t},resetState:function(){this.aux_container.hide(),this.aux_list.empty(),this.collection_list.empty();var t=this.$(".new-collections");t.removeClass("hide activated"),t.find("input.text").val(""),this.$el.removeClass("no-lists"),this.collection_list.find(".collection.shim").remove()},reinitialize:function(t,e){var i=this,n=!1,s=!1;this.resetState(),e.each(function(e){e.get("is_favorites")||(s=!0,"page_collection"===e.get("type")?(n||(i.aux_container.show(),i.aux_container.find("label").html('<a href="/pages/'+e.get("page_slug")+'?ref=list_btn">'+e.get("page_name")+"</a>"),n=!0),i.addCollection(t,e,i.aux_list)):i.addCollection(t,e,i.collection_list))}),this.$el.toggleClass("no-lists",!s)},addCollection:function(t,i,n){var s=new e({model:i,listing_id:t,parent:this.parent_view});i.on("sync",this.postListingAdded,this),n.append(s.render().el)},postListingAdded:function(){this.collection_list.find(".collection.shim").remove()}});return n}),define("lib/hogan",[],function(){if("undefined"!=typeof window){if(window.Hogan)return window.Hogan;var t=setInterval(function i(){i.runCount=(i.runCount||0)+1,window.Etsy&&window.Etsy.Logger&&(Etsy.Logger.warn("[FE-406] Hogan defined in bundle"),clearInterval(t)),i.runCount>10&&clearInterval(t)},500)}var e={};return function(t,e){function i(t,e,i){var n;return e&&"object"==typeof e&&(null!=e[t]?n=e[t]:i&&e.get&&"function"==typeof e.get&&(n=e.get(t))),n}function n(t,e,i,n){function s(){}function o(){}s.prototype=t,o.prototype=t.subs;var r,a=new s;a.subs=new o,a.subsText={},a.ib();for(r in e)a.subs[r]=e[r],a.subsText[r]=n;for(r in i)a.partials[r]=i[r];return a}function s(t){return String(null===t||void 0===t?"":t)}function o(t){return t=s(t),d.test(t)?t.replace(r,"&amp;").replace(a,"&lt;").replace(l,"&gt;").replace(c,"&#39;").replace(h,"&quot;"):t}t.Template=function(t,e,i,n){t=t||{},this.r=t.code||this.r,this.c=i,this.options=n||{},this.text=e||"",this.partials=t.partials||{},this.subs=t.subs||{},this.ib()},t.Template.prototype={r:function(){return""},v:o,t:s,render:function(t,e,i){return this.ri([t],e||{},i)},ri:function(t,e,i){return this.r(t,e,i)},ep:function(t,e){var i=this.partials[t],s=e[i.name];if(i.instance&&i.base==s)return i.instance;if("string"==typeof s){if(!this.c)throw new Error("No compiler available.");s=this.c.compile(s,this.options)}return s?(this.partials[t].base=s,i.subs&&(void 0===this.activeSub&&(e.stackText=this.text),s=n(s,i.subs,i.partials,e.stackText||this.text)),this.partials[t].instance=s,s):null},rp:function(t,e,i,n){var s=this.ep(t,i);return s?s.ri(e,i,n):""},rs:function(t,e,i){var n=t[t.length-1];if(!u(n))return void i(t,e,this);for(var s=0;s<n.length;s++)t.push(n[s]),i(t,e,this),t.pop()},s:function(t,e,i,n,s,o,r){var a;return u(t)&&0===t.length?!1:("function"==typeof t&&(t=this.ms(t,e,i,n,s,o,r)),a=!!t,!n&&a&&e&&e.push("object"==typeof t?t:e[e.length-1]),a)},d:function(t,e,n,s){var o,r=t.split("."),a=this.f(r[0],e,n,s),l=this.options.modelGet,c=null;if("."===t&&u(e[e.length-2]))a=e[e.length-1];else for(var h=1;h<r.length;h++)o=i(r[h],a,l),null!=o?(c=a,a=o):a="";return s&&!a?!1:(s||"function"!=typeof a||(e.push(c),a=this.mv(a,e,n),e.pop()),a)},f:function(t,e,n,s){for(var o=!1,r=null,a=!1,l=this.options.modelGet,c=e.length-1;c>=0;c--)if(r=e[c],o=i(t,r,l),null!=o){a=!0;break}return a?(s||"function"!=typeof o||(o=this.mv(o,e,n)),o):s?!1:""},ls:function(t,e,i,n,o){var r=this.options.delimiters;return this.options.delimiters=o,this.b(this.ct(s(t.call(e,n)),e,i)),this.options.delimiters=r,!1},ct:function(t,e,i){if(this.options.disableLambda)throw new Error("Lambda features disabled.");return this.c.compile(t,this.options).render(e,i)},b:e?function(t){this.buf.push(t)}:function(t){this.buf+=t},fl:e?function(){var t=this.buf.join("");return this.buf=[],t}:function(){var t=this.buf;return this.buf="",t},ib:function(){this.buf=e?[]:""},ms:function(t,e,i,n,s,o,r){var a,l=e[e.length-1],c=t.call(l);return"function"==typeof c?n?!0:(a=this.activeSub&&this.subsText[this.activeSub]?this.subsText[this.activeSub]:this.text,this.ls(c,l,i,a.substring(s,o),r)):c},mv:function(t,e,i){var n=e[e.length-1],o=t.call(n);return"function"==typeof o?this.ct(s(o.call(n)),n,i):o},sub:function(t,e,i,n){var s=this.subs[t];s&&(this.activeSub=t,s(e,i,this,n),this.activeSub=!1)}};var r=/&/g,a=/</g,l=/>/g,c=/\'/g,h=/\"/g,d=/[&<>\"\']/,u=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}}("undefined"!=typeof exports?exports:e),function(t){function e(t){"}"===t.n.substr(t.n.length-1)&&(t.n=t.n.substring(0,t.n.length-1))}function i(t){return t.trim?t.trim():t.replace(/^\s*|\s*$/g,"")}function n(t,e,i){if(e.charAt(i)!=t.charAt(0))return!1;for(var n=1,s=t.length;s>n;n++)if(e.charAt(i+n)!=t.charAt(n))return!1;return!0}function s(e,i,n,a){var l=[],c=null,h=null,d=null;for(h=n[n.length-1];e.length>0;){if(d=e.shift(),h&&"<"==h.tag&&!(d.tag in y))throw new Error("Illegal content in < super tag.");if(t.tags[d.tag]<=t.tags.$||o(d,a))n.push(d),d.nodes=s(e,d.tag,n,a);else{if("/"==d.tag){if(0===n.length)throw new Error("Closing tag without opener: /"+d.n);if(c=n.pop(),d.n!=c.n&&!r(d.n,c.n,a))throw new Error("Nesting error: "+c.n+" vs. "+d.n);return c.end=d.i,l}"\n"==d.tag&&(d.last=0==e.length||"\n"==e[0].tag)}l.push(d)}if(n.length>0)throw new Error("missing closing tag: "+n.pop().n);return l}function o(t,e){for(var i=0,n=e.length;n>i;i++)if(e[i].o==t.n)return t.tag="#",!0}function r(t,e,i){for(var n=0,s=i.length;s>n;n++)if(i[n].c==t&&i[n].o==e)return!0}function a(t){var e=[];for(var i in t)e.push('"'+c(i)+'": function(c,p,t,i) {'+t[i]+"}");return"{ "+e.join(",")+" }"}function l(t){var e=[];for(var i in t.partials)e.push('"'+c(i)+'":{name:"'+c(t.partials[i].name)+'", '+l(t.partials[i])+"}");return"partials: {"+e.join(",")+"}, subs: "+a(t.subs)}function c(t){return t.replace(_,"\\\\").replace(p,'\\"').replace(v,"\\n").replace(m,"\\r")}function h(t){return~t.indexOf(".")?"d":"f"}function d(t,e){var i="<"+(e.prefix||""),n=i+t.n+b++;return e.partials[n]={name:t.n,partials:{}},e.code+='t.b(t.rp("'+c(n)+'",c,p,"'+(t.indent||"")+'"));',n}function u(t,e){e.code+="t.b(t.t(t."+h(t.n)+'("'+c(t.n)+'",c,p,0)));'}function g(t){return"t.b("+t+");"}var f=/\S/,p=/\"/g,v=/\n/g,m=/\r/g,_=/\\/g;t.tags={"#":1,"^":2,"<":3,$:4,"/":5,"!":6,">":7,"=":8,_v:9,"{":10,"&":11,_t:12},t.scan=function(s,o){function r(){_.length>0&&(y.push({tag:"_t",text:new String(_)}),_="")}function a(){for(var e=!0,i=C;i<y.length;i++)if(e=t.tags[y[i].tag]<t.tags._v||"_t"==y[i].tag&&null===y[i].text.match(f),!e)return!1;return e}function l(t,e){if(r(),t&&a())for(var i,n=C;n<y.length;n++)y[n].text&&((i=y[n+1])&&">"==i.tag&&(i.indent=y[n].text.toString()),y.splice(n,1));else e||y.push({tag:"\n"});b=!1,C=y.length}function c(t,e){var n="="+x,s=t.indexOf(n,e),o=i(t.substring(t.indexOf("=",e)+1,s)).split(" ");return E=o[0],x=o[o.length-1],s+n.length-1}var h=s.length,d=0,u=1,g=2,p=d,v=null,m=null,_="",y=[],b=!1,w=0,C=0,E="{{",x="}}";for(o&&(o=o.split(" "),E=o[0],x=o[1]),w=0;h>w;w++)p==d?n(E,s,w)?(--w,r(),p=u):"\n"==s.charAt(w)?l(b):_+=s.charAt(w):p==u?(w+=E.length-1,m=t.tags[s.charAt(w+1)],v=m?s.charAt(w+1):"_v","="==v?(w=c(s,w),p=d):(m&&w++,p=g),b=w):n(x,s,w)?(y.push({tag:v,n:i(_),otag:E,ctag:x,i:"/"==v?b-E.length:w+x.length}),_="",w+=x.length-1,p=d,"{"==v&&("}}"==x?w++:e(y[y.length-1]))):_+=s.charAt(w);return l(b,!0),y};var y={_t:!0,"\n":!0,$:!0,"/":!0};t.stringify=function(e){return"{code: function (c,p,i) { "+t.wrapMain(e.code)+" },"+l(e)+"}"};var b=0;t.generate=function(e,i,n){b=0;var s={code:"",subs:{},partials:{}};return t.walk(e,s),n.asString?this.stringify(s,i,n):this.makeTemplate(s,i,n)},t.wrapMain=function(t){return'var t=this;t.b(i=i||"");'+t+"return t.fl();"},t.template=t.Template,t.makeTemplate=function(t,e,i){var n=this.makePartials(t);return n.code=new Function("c","p","i",this.wrapMain(t.code)),new this.template(n,e,this,i)},t.makePartials=function(t){var e,i={subs:{},partials:t.partials,name:t.name};for(e in i.partials)i.partials[e]=this.makePartials(i.partials[e]);for(e in t.subs)i.subs[e]=new Function("c","p","t","i",t.subs[e]);return i},t.codegen={"#":function(e,i){i.code+="if(t.s(t."+h(e.n)+'("'+c(e.n)+'",c,p,1),c,p,0,'+e.i+","+e.end+',"'+e.otag+" "+e.ctag+'")){t.rs(c,p,function(c,p,t){',t.walk(e.nodes,i),i.code+="});c.pop();}"},"^":function(e,i){i.code+="if(!t.s(t."+h(e.n)+'("'+c(e.n)+'",c,p,1),c,p,1,0,0,"")){',t.walk(e.nodes,i),i.code+="};"},">":d,"<":function(e,i){var n={partials:{},code:"",subs:{},inPartial:!0};t.walk(e.nodes,n);var s=i.partials[d(e,i)];s.subs=n.subs,s.partials=n.partials},$:function(e,i){var n={subs:{},code:"",partials:i.partials,prefix:e.n};t.walk(e.nodes,n),i.subs[e.n]=n.code,i.inPartial||(i.code+='t.sub("'+c(e.n)+'",c,p,i);')},"\n":function(t,e){e.code+=g('"\\n"'+(t.last?"":" + i"))},_v:function(t,e){e.code+="t.b(t.v(t."+h(t.n)+'("'+c(t.n)+'",c,p,0)));'},_t:function(t,e){e.code+=g('"'+c(t.text)+'"')},"{":u,"&":u},t.walk=function(e,i){for(var n,s=0,o=e.length;o>s;s++)n=t.codegen[e[s].tag],n&&n(e[s],i);return i},t.parse=function(t,e,i){return i=i||{},s(t,"",[],i.sectionTags||[])},t.cache={},t.cacheKey=function(t,e){return[t,!!e.asString,!!e.disableLambda,e.delimiters,!!e.modelGet].join("||")},t.compile=function(e,i){i=i||{};var n=t.cacheKey(e,i),s=this.cache[n];return s?s:(s=this.generate(this.parse(this.scan(e,i.delimiters),e,i),e,i),this.cache[n]=s)}}("undefined"!=typeof exports?exports:e),"undefined"!=typeof window?window.Hogan=window.hogan=e:e}),define("text",["module"],function(t){var e,i,n,s,o,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],a=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c="undefined"!=typeof location&&location.href,h=c&&location.protocol&&location.protocol.replace(/\:/,""),d=c&&location.hostname,u=c&&(location.port||void 0),g={},f=t.config&&t.config()||{};return e={version:"2.0.12",strip:function(t){if(t){t=t.replace(a,"");var e=t.match(l);e&&(t=e[1])}else t="";return t},jsEscape:function(t){return t.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:f.createXhr||function(){var t,e,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(e=0;3>e;e+=1){i=r[e];try{t=new ActiveXObject(i)}catch(n){}if(t){r=[i];break}}return t},parseName:function(t){var e,i,n,s=!1,o=t.indexOf("."),r=0===t.indexOf("./")||0===t.indexOf("../");return-1!==o&&(!r||o>1)?(e=t.substring(0,o),i=t.substring(o+1,t.length)):e=t,n=i||e,o=n.indexOf("!"),-1!==o&&(s="strip"===n.substring(o+1),n=n.substring(0,o),i?i=n:e=n),{moduleName:e,ext:i,strip:s}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(t,i,n,s){var o,r,a,l=e.xdRegExp.exec(t);return l?(o=l[2],r=l[3],r=r.split(":"),a=r[1],r=r[0],!(o&&o!==i||r&&r.toLowerCase()!==n.toLowerCase()||(a||r)&&a!==s)):!0},finishLoad:function(t,i,n,s){n=i?e.strip(n):n,f.isBuild&&(g[t]=n),s(n)},load:function(t,i,n,s){if(s&&s.isBuild&&!s.inlineText)return void n();f.isBuild=s&&s.isBuild;var o=e.parseName(t),r=o.moduleName+(o.ext?"."+o.ext:""),a=i.toUrl(r),l=f.useXhr||e.useXhr;return 0===a.indexOf("empty:")?void n():void(!c||l(a,h,d,u)?e.get(a,function(i){e.finishLoad(t,o.strip,i,n)},function(t){n.error&&n.error(t)}):i([r],function(t){e.finishLoad(o.moduleName+"."+o.ext,o.strip,t,n)}))},write:function(t,i,n){if(g.hasOwnProperty(i)){var s=e.jsEscape(g[i]);n.asModule(t+"!"+i,"define(function () { return '"+s+"';});\n")}},writeFile:function(t,i,n,s,o){var r=e.parseName(i),a=r.ext?"."+r.ext:"",l=r.moduleName+a,c=n.toUrl(r.moduleName+a)+".js";e.load(l,n,function(){var i=function(t){return s(c,t)};i.asModule=function(t,e){return s.asModule(t,c,e)},e.write(t,l,i,o)},o)}},"node"===f.env||!f.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(i=require.nodeRequire("fs"),e.get=function(t,e,n){try{var s=i.readFileSync(t,"utf8");0===s.indexOf("ï»¿")&&(s=s.substring(1)),e(s)}catch(o){n&&n(o)}}):"xhr"===f.env||!f.env&&e.createXhr()?e.get=function(t,i,n,s){var o,r=e.createXhr();if(r.open("GET",t,!0),s)for(o in s)s.hasOwnProperty(o)&&r.setRequestHeader(o.toLowerCase(),s[o]);f.onXhr&&f.onXhr(r,t),r.onreadystatechange=function(){var e,s;4===r.readyState&&(e=r.status||0,e>399&&600>e?(s=new Error(t+" HTTP status: "+e),s.xhr=r,n&&n(s)):i(r.responseText),f.onXhrComplete&&f.onXhrComplete(r,t))},r.send(null)}:"rhino"===f.env||!f.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?e.get=function(t,e){var i,n,s="utf-8",o=new java.io.File(t),r=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),s)),l="";try{for(i=new java.lang.StringBuffer,n=a.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&i.append(n);null!==(n=a.readLine());)i.append(r),i.append(n);l=String(i.toString())}finally{a.close()}e(l)}:("xpconnect"===f.env||!f.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(n=Components.classes,s=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),o="@mozilla.org/windows-registry-key;1"in n,e.get=function(t,e){var i,r,a,l={};o&&(t=t.replace(/\//g,"\\")),a=new FileUtils.File(t);try{i=n["@mozilla.org/network/file-input-stream;1"].createInstance(s.nsIFileInputStream),i.init(a,1,0,!1),r=n["@mozilla.org/intl/converter-input-stream;1"].createInstance(s.nsIConverterInputStream),r.init(i,"utf-8",i.available(),s.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),r.readString(i.available(),l),r.close(),i.close(),e(l.value)}catch(c){throw new Error((a&&a.path||"")+": "+c)}}),e}),define("template",["lib/hogan","text"],function(t,e){function i(t,e,i){return i.isBuild?g.resolve(i.baseUrl,"../../..","templates",t):e.toUrl(t)}function n(n,r,a,d){var g=d.template||{},p=n;return p+=g&&null!=g.templateExtension?g.templateExtension:l,h[n]?a(null):void e.get(i(p,r,d),function(e){var l=g.compilationOptions?o({},g.compilationOptions):{};if(d.isBuild){l.asString=!0;var h="{{[<>]s?([^}]*)}}",v=new RegExp(h,"g"),m=new RegExp(h);u[n]=[],function b(t){var e=t.match(v);if(!e)return!1;var s=[];e.forEach(function(t){var e=t.match(m)[1];s.concat(u[n]).indexOf(e)<0&&s.push(e.replace(/^\s*|\s*$/g,""))}),u[n]=u[n].concat(s),s.forEach(function(t){var e=i(t,r,d),n=""+f.readFileSync(e),s=t.replace(/\.mustache$/,"");b(n),d.onBuildRead("template!"+s,i(t,r,d),n),c[s]=!1})}(e),c[n]=!1,d.onBuildRead("template!"+n,i(p,r,d),e)}var _=t.compile(e,l),y=s(_.render,_);y.text=_.text,y.template=_,a(y)},function(t){a.error(t)})}function s(t,e){return function(){return t.apply(e,arguments)}}function o(t,e){var i;for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}function r(e,i,n){if(h[i])return n("");var s="";a||(a=t.compile(d));var o;for(var r in c)h[r]||(o={pluginName:e,moduleName:r,partials:'"lib/hogan"'},u[r]&&(o.partials=u[r],u[r]=u[r].concat([]),o.partials.forEach(function(t,e,i){i[e]='"template!'+t.replace(/\.mustache$/,"")+'"'}),o.partials.unshift('"lib/hogan"'),o.partials=o.partials.join(",")),s+=a.render(o),h[r]=!0);h[i]=!0,n(s)}if("undefined"!=typeof window)return{};var a,l=".mustache",c={},h={},d='define("{{pluginName}}!{{moduleName}}", [{{{partials}}}], function(hogan){ throw "template!{{moduleName}} not loaded"; });\n',u={},g=require.nodeRequire("path"),f=require.nodeRequire("fs");return{load:n,write:r}}),define("template!modules/collections/chooser",["lib/hogan"],function(){    hogan.partialsMap = hogan.partialsMap || {};    var tmpl = new hogan.Template({ code: function(c,p,i){var _=this;_.b(i=i||"");_.b("<div class=\"collection-chooser\">");_.b("\n" + i);_.b("    <div class=\"aux-collections\">");_.b("\n" + i);_.b("        <label class=\"collection-group\"></label>");_.b("\n" + i);_.b("        <ul class=\"collection-list list-aux  clear\">");_.b("\n" + i);_.b("        </ul>");_.b("\n" + i);_.b("    </div>");_.b("\n" + i);_.b("    <div class=\"user-collections\">");_.b("\n" + i);_.b("        <label class=\"collection-group\">");_.b("\n" + i);_.b("            <a>Your lists</a>");_.b("\n" + i);_.b("        </label>");_.b("\n" + i);_.b("        <ul class=\"collection-list list-main clear\">");_.b("\n" + i);_.b("        </ul>");_.b("\n" + i);_.b("\n" + i);_.b("        <div class=\"new-collections clear\">");_.b("\n" + i);_.b("            <input type=\"text\" class=\"text\" placeholder=\"New list\" />");_.b("\n" + i);_.b("            <button class=\"btn-primary small btn\">Add</button>");_.b("\n" + i);_.b("\n" + i);_.b("            <div class=\"error-msg\"></div>");_.b("\n" + i);_.b("        </div>");_.b("\n" + i);_.b("    </div>");_.b("\n" + i);_.b("\n" + i);_.b("    <span class=\"arrow\"></span>");_.b("\n" + i);_.b("</div>");return _.fl();;}, partials: hogan.partialsMap }, "", hogan);    tmpl.name = "modules/collections/chooser.mustache";    function render(data) {      data = data || {};      data._messages = Etsy.message_catalog;      return tmpl.render.call(tmpl, data, hogan.partialsMap);    }    render.template = tmpl;    hogan.partialsMap[tmpl.name] = tmpl;    return render;}),require.config({paths:{"collections/views/SharedChooser":"collections/views/SharedChooser.20161027161911","template!modules/collections/chooser":"template!modules/collections/chooser.20150806155415"}}),define("collections/managers/SharedChooser",["jquery","collections/views/SharedChooser","template!modules/collections/chooser"],function(t,e,i){var n=function(t){this.chooser=t};return n.prototype={getChooser:function(){return this.chooser},detach:function(){this.chooser.$el.detach(),this.chooser.off()},detachFrom:function(e){var i=t(e)[0];t.contains(i,this.chooser.el)&&this.detach()},attachTo:function(t,e,i,n){this.detach(),this.chooser.setParent(e),this.chooser.reinitialize(i,n),this.chooser.$el.appendTo(t)}},n.getSingleton=function(){if(Etsy.Sets=Etsy.Sets||{},Etsy.Sets.Context=Etsy.Sets.Context||{},!Etsy.Sets.Context.collectionsChooser){var s=new e({el:t(i())});Etsy.Sets.Context.collectionsChooser=new n(s)}return Etsy.Sets.Context.collectionsChooser},n}),require.config({paths:{"collections/models/CollectionCollection":"collections/models/CollectionCollection.20161027161911","collections/models/Collection":"collections/models/Collection.20161027161911","collections/views/CollectionList":"collections/views/CollectionList.20161027161911","collections/managers/SharedChooser":"collections/managers/SharedChooser.20161027161911"}}),define("collections/views/Button",["jquery","collections/models/CollectionCollection","collections/models/Collection","collections/views/CollectionList","collections/managers/SharedChooser"],function(t,e,i,n,s){var o=Backbone.View.extend({initialize:function(){this.user_id=Etsy.getSignedInUserId(),this.user_login_name=Etsy.getSignedInLoginName(),this.container=this.$el.parents(".collect-container"),this.shared_chooser_manager=s.getSingleton(),this.shared_chooser=this.shared_chooser_manager.getChooser(),this.recent_list=this.container.find(".list-featured"),this.count=this.$el.find(".count"),this.listing_card=this.$el.closest(".collected-listing,.listing-card,.object-card"),this.card_grid=Etsy.Context.getData("collections_use_grid",!1)?this.listing_card.parent():null,this.listing_id=this.container.data("listing-id"),this.options.listingsMap.add({listing_id:this.listing_id}),this.options.collections?this.updateCollections():this.options.collections=new e({userId:this.user_id});var t=this;this.options.collections.on("reset",this.updateCollections,this),this.options.collections.on("add",this.updateCollections,this),this.handleOutsideClick(),this.handleHover(),this.handleFocus(),this.on("loading",function(){t.container.addClass("loading"),t.$el.addClass("loading")}),this.collectionSaveSuccess=_.bind(this.collectionSaveSuccess,this),this.collectionSaveError=_.bind(this.collectionSaveError,this)},handleHover:function(){var t=this,e=null;this.listing_card.mouseleave(function(){var i=t.container.hasClass("show-menu")?500:0;e=window.setTimeout(function(){t.listing_card.removeClass("col-hover"),t.hideChooser()},i)}),this.listing_card.mouseenter(function(){t.listing_card.addClass("col-hover"),window.clearTimeout(e)})},handleFocus:function(){var t=this;this.listing_card.focusin(function(){t.listing_card.addClass("col-focus")}),this.listing_card.focusout(function(){t.listing_card.removeClass("col-focus")})},hideChooser:function(){this.container.removeClass("show-menu"),this.shared_chooser.alignStandard(),this.shared_chooser_manager.detachFrom(this.container),this.listing_card.css({"z-index":"auto"})},events:{click:"toggleCollectionChooser"},handleOutsideClick:function(){var e=this;this.container.click(function(t){t.stopPropagation()}),t("html").click(function(){e.hideChooser()})},toggleCollectionChooser:function(e){if(this.container.toggleClass("show-menu"),this.shared_chooser.alignStandard(),this.container.hasClass("show-menu")){this.listing_card.css({"z-index":1e4});var i={php_event_name:"list_open",source:t(".btn-fave, [data-btn-fave]").data("source")};i=t.extend(!0,Etsy.LoggingParams.getFromDOM(this.$el),i);var n=t.extend(!0,{},i);Etsy.EventLogger.logEvent(i),n.php_event_name="collection_icon_clicked",Etsy.EventLogger.logEvent(n),this.shared_chooser_manager.attachTo(this.container,this,this.listing_id,this.options.collections),this.shared_chooser.adjustAlignment(this.card_grid)}else this.shared_chooser_manager.detachFrom(this.container);e.preventDefault()},updateCollections:function(){if(this.options.collections.each(function(t){t.off("sync",this.postListingAdded,this),t.on("sync",this.postListingAdded,this)},this),Etsy.Context.data.collection){var t=this.options.collections.where({key:Etsy.Context.data.collection.key});t.length>0&&(t[0].on("listing-removed",function(t){this.listing_id==t&&this.listing_card.addClass("removed")},this),t[0].on("listing-added",function(t){this.listing_id==t&&this.listing_card.removeClass("removed")},this))}this.updateCollectionState()},addCollection:function(t,e){var i=new n({model:t,listing_id:this.listing_id,parent:this});t.on("sync",this.postListingAdded,this),e.append(i.render().el)},postListingAdded:function(){this.updateCollectionState(),this.container.removeClass("loading"),this.$el.removeClass("loading"),this.hideChooser()},updateCollectionState:function(){var t=this.options.collections.filter(function(t){return!t.get("is_favorites")}),e=_(t).filter(function(t){return t.containsListing(this.listing_id)},this).length;e?this.$el.addClass("done"):this.$el.removeClass("done")},createCollectionAndAddListing:function(t){this.trigger("loading");var e=new i;e.save({name:t},{success:this.collectionSaveSuccess,error:this.collectionSaveError})},collectionSaveSuccess:function(e){var i=t(".favorite-container .btn-fave, .favorite-container [data-btn-fave]").data("source");this.options.collections.models.push(e),this.options.collections.trigger("add",e),e.addListing(this.listing_id);var n={php_event_name:"collection_create",collection_id:e.get("collection_id"),name:e.get("name"),source:i};n=t.extend(!0,Etsy.LoggingParams.getFromDOM(this.$el),n),Etsy.EventLogger.logEvent(n),this.logListingEvent(this.listing_id,e,!0)},collectionSaveError:function(e,i){if(_.isArray(i))alert(_(i).pluck("message").join(" "));else{var n=t.parseJSON(i.responseText);if(n.errors&&n.errors[0]){var s=n.errors[0],o="";_(s).each(function(t){o+=t.join(" ")}),alert(o)}else alert("There was a problem creating your collection.")}this.postListingAdded()},isInListingCard:function(){return this.container.parents(".listing-card").length>0},logListingEvent:function(e,i,n){var s=t(".favorite-container .btn-fave, .favorite-container [data-btn-fave]").data("source"),o={php_event_name:n?"list_add":"list_remove",listing_id:e,source:s};o=t.extend(!0,Etsy.LoggingParams.getFromDOM(this.$el),o);var r,a;i.get("is_registry")?(r=t.extend(!0,{},o),o.list_type="registry",o.list_id=i.get("collection_id"),r.php_event_name=n?"listing_registry_add":"listing_registry_remove",r.registry_id=i.get("collection_id"),Etsy.EventLogger.logEvent(r)):(a=t.extend(!0,{},o),o.list_name=i.get("name"),o.list_type="collection",o.list_id=i.get("collection_id"),a.php_event_name=n?"collection_add":"collection_remove",a.collection_name=i.get("name"),a.collection_id=i.get("collection_id"),a=t.extend(!0,Etsy.LoggingParams.getFromDOM(this.$el),a),Etsy.EventLogger.logEvent(a)),Etsy.EventLogger.logEvent(o)
}});return o}),require.config({paths:{"collections/models/CollectionCollection":"collections/models/CollectionCollection.20161027161911"}}),define("collections/views/FavoriteButton",["jquery","collections/models/CollectionCollection"],function(t,e){var i="favorite",n=Backbone.View.extend({events:{click:"toggleFavorites"},initialize:function(){this.user_id=Etsy.getSignedInUserId(),this.container=this.$el.closest(".favorite-container"),this.listing_id=this.container.data("listing-id"),this.options.collections?this.updateModel():this.options.collections=new e({userId:this.user_id}),this.options.collections.on("reset",this.updateModel,this),this.isCurrentCollection=!1,Etsy.Context.data.collection&&(this.isCurrentCollection=Etsy.Context.data.collection.is_favorites)},updateModel:function(){var t=this.options.collections.where({is_favorites:!0})[0];t&&(this.model=t,this.model.on("sync",this.render,this),this.model.on("listing-added",this.listingAdded,this),this.model.on("listing-removed",this.listingRemoved,this),this.render())},listingAdded:function(t){this.isCurrentCollection&&this.listing_id==t&&this.$el.addClass("removed")},listingRemoved:function(t){this.isCurrentCollection&&this.listing_id==t&&this.$el.removeClass("removed")},render:function(){this.$el.removeClass("loading"),this.model.containsListing(this.listing_id)?this.$el.addClass("done").attr({"aria-pressed":!0}):this.$el.removeClass("done").attr({"aria-pressed":!1})},toggleFavorites:function(){if(this.model){var e=this.$el.data("source"),n=this.$el.data("can-refavorite")||!1,s=this.$el.data("attributee-id"),o=!0;this.$el.addClass("loading"),this.model.containsListing(this.listing_id)?this.model.removeListing(this.listing_id):(s?this.model.addListing(this.listing_id,{attributee_id:s}):this.model.addListing(this.listing_id),o=!1);var r={php_event_name:o?"remove_favorite_item":"favorite_item",listing_id:this.listing_id,source:e};r=t.extend(!0,Etsy.LoggingParams.getFromDOM(this.$el),r),"listing"==e&&(r.shop_id=this.$el.data("shop-id"),r.shop_user_id=this.$el.data("shop-user-id"),r.shop_shop_id=this.$el.data("shop-shop-id"),r.position=this.$el.data("position")),!o&&s&&(r.attributee_id=s,r.attribution_source=this.$el.data("attribution-source")||i,t(document).trigger("etsy:favorite:button:toggle",[this.listing_id,e,s,n]));var a=t.extend(!0,{},r),l=t.extend(!0,{},r);Etsy.EventLogger.logEvent(r),a.php_event_name=a.php_event_name+"_clicked",Etsy.EventLogger.logEvent(a),l.php_event_name="favorite_item"===r.php_event_name?"list_add":"list_remove",l.list_type="favorites",Etsy.EventLogger.logEvent(l)}}});return n}),define("collections/models/CollectionListingsMap",["jquery"],function(t){var e=Backbone.Collection.extend({map:{},fetchCollections:function(){var e=this.pluck("listing_id");e.length&&t.ajax({url:Etsy.Backbone.API_URL+"collections/listings_map",data:{listing_ids:e.join(",")},context:this}).done(function(t){t.results&&t.results[0]&&(this.reset(),_.each(t.results[0],function(t,e){this.map[e]||(this.map[e]=[]),_.each(t,function(t){this.map[e].push(t)},this)},this),this.trigger("sync",t.results[0]))})}});return e}),require.config({paths:{"collections/views/Button":"collections/views/Button.20161027161911","collections/views/FavoriteButton":"collections/views/FavoriteButton.20161027161911","collections/models/CollectionListingsMap":"collections/models/CollectionListingsMap.20161027161911","collections/models/CollectionCollection":"collections/models/CollectionCollection.20161027161911"}}),define("collections/App",["jquery","collections/views/Button","collections/views/FavoriteButton","collections/models/CollectionListingsMap","collections/models/CollectionCollection"],function(t,e,i,n,s){var o=function(){Etsy.getSignedInUserId()&&(this.listingsMap=new n,this.userCollections=new s({userId:Etsy.getSignedInUserId(),listingsMap:this.listingsMap}),this.initializeButtons())};return o.prototype={initializeButtons:function(){var n=this;t(".btn-collect, [data-btn-collect]").not(".overlay-trigger").each(function(){if(!t(this).data("view")){var i=new e({el:t(this),listingsMap:n.listingsMap,collections:n.userCollections});t(this).data("view",i)}}),t(".btn-fave, [data-btn-fave]").not(".overlay-trigger").each(function(){if(!t(this).data("view")){var e=new i({el:t(this),listingsMap:n.listingsMap,collections:n.userCollections});t(this).data("view",e)}}),this.listingsMap.fetchCollections()}},o.init=function(){return Etsy.Sets=Etsy.Sets||{},Etsy.Sets.Context=Etsy.Sets.Context||{},Etsy.Sets.Context.app||(Etsy.Sets.Context.app=new o),Etsy.Sets.Context.app},o}),function(){var t,e=this,i=e.Backbone,n=Array.prototype.slice,s=Array.prototype.splice;t="undefined"!=typeof exports?exports:e.Backbone={},t.VERSION="0.9.2";var o=e._;o||"undefined"==typeof require||(o=require("underscore"));var r=e.jQuery||e.Zepto||e.ender;t.setDomLibrary=function(t){r=t},t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var a=/\s+/,l=t.Events={on:function(t,e,i){var n,s,o,r,l;if(!e)return this;for(t=t.split(a),n=this._callbacks||(this._callbacks={});s=t.shift();)l=n[s],o=l?l.tail:{},o.next=r={},o.context=i,o.callback=e,n[s]={tail:r,next:l?l.next:o};return this},off:function(t,e,i){var n,s,r,l,c,h;if(s=this._callbacks){if(!(t||e||i))return delete this._callbacks,this;for(t=t?t.split(a):o.keys(s);n=t.shift();)if(r=s[n],delete s[n],r&&(e||i))for(l=r.tail;(r=r.next)!==l;)c=r.callback,h=r.context,(e&&c!==e||i&&h!==i)&&this.on(n,c,h);return this}},trigger:function(t){var e,i,s,o,r,l,c;if(!(s=this._callbacks))return this;for(l=s.all,t=t.split(a),c=n.call(arguments,1);e=t.shift();){if(i=s[e])for(o=i.tail;(i=i.next)!==o;)i.callback.apply(i.context||this,c);if(i=l)for(o=i.tail,r=[e].concat(c);(i=i.next)!==o;)i.callback.apply(i.context||this,r)}return this}};l.bind=l.on,l.unbind=l.off;var c=t.Model=function(t,e){var i;t||(t={}),e&&e.parse&&(t=this.parse(t)),(i=L(this,"defaults"))&&(t=o.extend({},i,t)),e&&e.collection&&(this.collection=e.collection),this.attributes={},this._escapedAttributes={},this.cid=o.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(t,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=o.clone(this.attributes),this.initialize.apply(this,arguments)};o.extend(c.prototype,l,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(){return o.clone(this.attributes)},get:function(t){return this.attributes[t]},escape:function(t){var e;if(e=this._escapedAttributes[t])return e;var i=this.get(t);return this._escapedAttributes[t]=o.escape(null==i?"":""+i)},has:function(t){return null!=this.get(t)},set:function(t,e,i){var n,s,r;if(o.isObject(t)||null==t?(n=t,i=e):(n={},n[t]=e),i||(i={}),!n)return this;if(n instanceof c&&(n=n.attributes),i.unset)for(s in n)n[s]=void 0;if(!this._validate(n,i))return!1;this.idAttribute in n&&(this.id=n[this.idAttribute]);var a=i.changes={},l=this.attributes,h=this._escapedAttributes,d=this._previousAttributes||{};for(s in n)r=n[s],(!o.isEqual(l[s],r)||i.unset&&o.has(l,s))&&(delete h[s],(i.silent?this._silent:a)[s]=!0),i.unset?delete l[s]:l[s]=r,o.isEqual(d[s],r)&&o.has(l,s)==o.has(d,s)?(delete this.changed[s],delete this._pending[s]):(this.changed[s]=r,i.silent||(this._pending[s]=!0));return i.silent||this.change(i),this},unset:function(t,e){return(e||(e={})).unset=!0,this.set(t,null,e)},clear:function(t){return(t||(t={})).unset=!0,this.set(o.clone(this.attributes),t)},fetch:function(e){e=e?o.clone(e):{};var i=this,n=e.success;return e.success=function(t,s,o){return i.set(i.parse(t,o),e)?void(n&&n(i,t)):!1},e.error=t.wrapError(e.error,i,e),(this.sync||t.sync).call(this,"read",this,e)},save:function(e,i,n){var s,r;if(o.isObject(e)||null==e?(s=e,n=i):(s={},s[e]=i),n=n?o.clone(n):{},n.wait){if(!this._validate(s,n))return!1;r=o.clone(this.attributes)}var a=o.extend({},n,{silent:!0});if(s&&!this.set(s,n.wait?a:n))return!1;var l=this,c=n.success;n.success=function(t,e,i){var r=l.parse(t,i);return n.wait&&(delete n.wait,r=o.extend(s||{},r)),l.set(r,n)?void(c?c(l,t):l.trigger("sync",l,t,n)):!1},n.error=t.wrapError(n.error,l,n);var h=this.isNew()?"create":"update",d=(this.sync||t.sync).call(this,h,this,n);return n.wait&&this.set(r,a),d},destroy:function(e){e=e?o.clone(e):{};var i=this,n=e.success,s=function(){i.trigger("destroy",i,i.collection,e)};if(this.isNew())return s(),!1;e.success=function(t){e.wait&&s(),n?n(i,t):i.trigger("sync",i,t,e)},e.error=t.wrapError(e.error,i,e);var r=(this.sync||t.sync).call(this,"delete",this,e);return e.wait||s(),r},url:function(){var t=L(this,"urlRoot")||L(this.collection,"url")||k();return this.isNew()?t:t+("/"==t.charAt(t.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(t){t||(t={});var e=this._changing;this._changing=!0;for(var i in this._silent)this._pending[i]=!0;var n=o.extend({},t.changes,this._silent);this._silent={};for(var i in n)this.trigger("change:"+i,this,this.get(i),t);if(e)return this;for(;!o.isEmpty(this._pending);){this._pending={},this.trigger("change",this,t);for(var i in this.changed)this._pending[i]||this._silent[i]||delete this.changed[i];this._previousAttributes=o.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(t){return arguments.length?o.has(this.changed,t):!o.isEmpty(this.changed)},changedAttributes:function(t){if(!t)return this.hasChanged()?o.clone(this.changed):!1;var e,i=!1,n=this._previousAttributes;for(var s in t)o.isEqual(n[s],e=t[s])||((i||(i={}))[s]=e);return i},previous:function(t){return arguments.length&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return o.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(t,e){if(e.silent||!this.validate)return!0;t=o.extend({},this.attributes,t);var i=this.validate(t,e);return i?(e&&e.error?e.error(this,i,e):this.trigger("error",this,i,e),!1):!0}});var h=t.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,{silent:!0,parse:e.parse})};o.extend(h.prototype,l,{model:c,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},add:function(t,e){var i,n,r,a,l,c,h={},d={},u=[];for(e||(e={}),t=o.isArray(t)?t.slice():[t],i=0,r=t.length;r>i;i++){if(!(a=t[i]=this._prepareModel(t[i],e)))throw new Error("Can't add an invalid model to a collection");l=a.cid,c=a.id,h[l]||this._byCid[l]||null!=c&&(d[c]||this._byId[c])?u.push(i):h[l]=d[c]=a}for(i=u.length;i--;)t.splice(u[i],1);for(i=0,r=t.length;r>i;i++)(a=t[i]).on("all",this._onModelEvent,this),this._byCid[a.cid]=a,null!=a.id&&(this._byId[a.id]=a);if(this.length+=r,n=null!=e.at?e.at:this.models.length,s.apply(this.models,[n,0].concat(t)),this.comparator&&this.sort({silent:!0}),e.silent)return this;for(i=0,r=this.models.length;r>i;i++)h[(a=this.models[i]).cid]&&(e.index=i,a.trigger("add",a,this,e));return this},remove:function(t,e){var i,n,s,r;for(e||(e={}),t=o.isArray(t)?t.slice():[t],i=0,n=t.length;n>i;i++)r=this.getByCid(t[i])||this.get(t[i]),r&&(delete this._byId[r.id],delete this._byCid[r.cid],s=this.indexOf(r),this.models.splice(s,1),this.length--,e.silent||(e.index=s,r.trigger("remove",r,this,e)),this._removeReference(r));return this},push:function(t,e){return t=this._prepareModel(t,e),this.add(t,e),t},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return t=this._prepareModel(t,e),this.add(t,o.extend({at:0},e)),t},shift:function(t){var e=this.at(0);return this.remove(e,t),e},get:function(t){return null==t?void 0:this._byId[null!=t.id?t.id:t]},getByCid:function(t){return t&&this._byCid[t.cid||t]},at:function(t){return this.models[t]},where:function(t){return o.isEmpty(t)?[]:this.filter(function(e){for(var i in t)if(t[i]!==e.get(i))return!1;return!0})},sort:function(t){if(t||(t={}),!this.comparator)throw new Error("Cannot sort a set without a comparator");var e=o.bind(this.comparator,this);return 1==this.comparator.length?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("reset",this,t),this},pluck:function(t){return o.map(this.models,function(e){return e.get(t)})},reset:function(t,e){t||(t=[]),e||(e={});for(var i=0,n=this.models.length;n>i;i++)this._removeReference(this.models[i]);return this._reset(),this.add(t,o.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),this},fetch:function(e){e=e?o.clone(e):{},void 0===e.parse&&(e.parse=!0);var i=this,n=e.success;return e.success=function(t,s,o){i[e.add?"add":"reset"](i.parse(t,o),e),n&&n(i,t)},e.error=t.wrapError(e.error,i,e),(this.sync||t.sync).call(this,"read",this,e)},create:function(t,e){var i=this;if(e=e?o.clone(e):{},t=this._prepareModel(t,e),!t)return!1;e.wait||i.add(t,e);var n=e.success;return e.success=function(s,o){e.wait&&i.add(s,e),n?n(s,o):s.trigger("sync",t,o,e)},t.save(null,e),t},parse:function(t){return t},chain:function(){return o(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(t,e){if(e||(e={}),t instanceof c)t.collection||(t.collection=this);else{var i=t;e.collection=this,t=new this.model(i,e),t._validate(t.attributes,e)||(t=!1)}return t},_removeReference:function(t){this==t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){("add"!=t&&"remove"!=t||i==this)&&("destroy"==t&&this.remove(e,n),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],this._byId[e.id]=e),this.trigger.apply(this,arguments))}});var d=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];o.each(d,function(t){h.prototype[t]=function(){return o[t].apply(o,[this.models].concat(o.toArray(arguments)))}});var u=t.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},g=/:\w+/g,f=/\*\w+/g,p=/[-[\]{}()+?.,\\^$|#\s]/g;o.extend(u.prototype,l,{initialize:function(){},route:function(e,i,n){return t.history||(t.history=new v),o.isRegExp(e)||(e=this._routeToRegExp(e)),n||(n=this[i]),t.history.route(e,o.bind(function(s){var o=this._extractParameters(e,s);n&&n.apply(this,o),this.trigger.apply(this,["route:"+i].concat(o)),t.history.trigger("route",this,i,o)},this)),this},navigate:function(e,i){t.history.navigate(e,i)},_bindRoutes:function(){if(this.routes){var t=[];for(var e in this.routes)t.unshift([e,this.routes[e]]);for(var i=0,n=t.length;n>i;i++)this.route(t[i][0],t[i][1],this[t[i][1]])}},_routeToRegExp:function(t){return t=t.replace(p,"\\$&").replace(g,"([^/]+)").replace(f,"(.*?)"),new RegExp("^"+t+"$")},_extractParameters:function(t,e){return t.exec(e).slice(1)}});var v=t.History=function(){this.handlers=[],o.bindAll(this,"checkUrl")},m=/^[#\/]/,_=/msie [\w.]+/;v.started=!1,o.extend(v.prototype,l,{interval:50,getHash:function(t){var e=t?t.location:window.location,i=e.href.match(/#(.*)$/);return i?i[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||e){t=window.location.pathname;var i=window.location.search;i&&(t+=i)}else t=this.getHash();return t.indexOf(this.options.root)||(t=t.substr(this.options.root.length)),t.replace(m,"")},start:function(t){if(v.started)throw new Error("Backbone.history has already been started");v.started=!0,this.options=o.extend({},{root:"/"},this.options,t),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var e=this.getFragment(),i=document.documentMode,n=_.exec(navigator.userAgent.toLowerCase())&&(!i||7>=i);n&&(this.iframe=r('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(e)),this._hasPushState?r(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!n?r(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=e;var s=window.location,a=s.pathname==this.options.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!a?(this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&a&&s.hash&&(this.fragment=this.getHash().replace(m,""),window.history.replaceState({},document.title,s.protocol+"//"+s.host+this.options.root+this.fragment)),this.options.silent?void 0:this.loadUrl())},stop:function(){r(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),v.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t==this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t==this.fragment?!1:(this.iframe&&this.navigate(t),void(this.loadUrl()||this.loadUrl(this.getHash())))},loadUrl:function(t){var e=this.fragment=this.getFragment(t),i=o.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0});return i},navigate:function(t,e){if(!v.started)return!1;e&&e!==!0||(e={trigger:e});var i=(t||"").replace(m,"");this.fragment!=i&&(this._hasPushState?(0!=i.indexOf(this.options.root)&&(i=this.options.root+i),this.fragment=i,window.history[e.replace?"replaceState":"pushState"]({},document.title,i)):this._wantsHashChange?(this.fragment=i,this._updateHash(window.location,i,e.replace),this.iframe&&i!=this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,i,e.replace))):window.location.assign(this.options.root+t),e.trigger&&this.loadUrl(t))},_updateHash:function(t,e,i){i?t.replace(t.toString().replace(/(javascript:|#).*$/,"")+"#"+e):t.hash=e}});var y=t.View=function(t){this.cid=o.uniqueId("view"),this._configure(t||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},b=/^(\S+)\s*(.*)$/,w=["model","collection","el","id","attributes","className","tagName"];o.extend(y.prototype,l,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(t,e,i){var n=document.createElement(t);return e&&r(n).attr(e),i&&r(n).html(i),n},setElement:function(t,e){return this.$el&&this.undelegateEvents(),this.$el=t instanceof r?t:r(t),this.el=this.$el[0],e!==!1&&this.delegateEvents(),this},delegateEvents:function(t){if(t||(t=L(this,"events"))){this.undelegateEvents();for(var e in t){var i=t[e];if(o.isFunction(i)||(i=this[t[e]]),!i)throw new Error('Method "'+t[e]+'" does not exist');var n=e.match(b),s=n[1],r=n[2];i=o.bind(i,this),s+=".delegateEvents"+this.cid,""===r?this.$el.bind(s,i):this.$el.delegate(r,s,i)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(t){this.options&&(t=o.extend({},this.options,t));for(var e=0,i=w.length;i>e;e++){var n=w[e];t[n]&&(this[n]=t[n])}this.options=t},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var t=L(this,"attributes")||{};this.id&&(t.id=this.id),this.className&&(t["class"]=this.className),this.setElement(this.make(this.tagName,t),!1)}}});var C=function(t,e){var i=S(this,t,e);return i.extend=this.extend,i};c.extend=h.extend=u.extend=y.extend=C;var E={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};t.sync=function(e,i,n){var s=E[e];n||(n={});var a={type:s,dataType:"json"};return n.url||(a.url=L(i,"url")||k()),n.data||!i||"create"!=e&&"update"!=e||(a.contentType="application/json",a.data=JSON.stringify(i.toJSON())),t.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),t.emulateHTTP&&("PUT"===s||"DELETE"===s)&&(t.emulateJSON&&(a.data._method=s),a.type="POST",a.beforeSend=function(t){t.setRequestHeader("X-HTTP-Method-Override",s)}),"GET"===a.type||t.emulateJSON||(a.processData=!1),r.ajax(o.extend(a,n))},t.wrapError=function(t,e,i){return function(n,s){s=n===e?s:n,t?t(e,s,i):e.trigger("error",e,s,i)}};var x=function(){},S=function(t,e,i){var n;return n=e&&e.hasOwnProperty("constructor")?e.constructor:function(){t.apply(this,arguments)},o.extend(n,t),x.prototype=t.prototype,n.prototype=new x,e&&o.extend(n.prototype,e),i&&o.extend(n,i),n.prototype.constructor=n,n.__super__=t.prototype,n},L=function(t,e){return t&&t[e]?o.isFunction(t[e])?t[e]():t[e]:null},k=function(){throw new Error('A "url" property or function must be specified')}}.call(this),function(t,e){e.Backbone=e.Backbone||{},e.Backbone.API_URL="/api/v2/ajax/",e.Backbone.Model=Backbone.Model.extend({toJSON:function(){return _(_.clone(this.attributes)).extend({_nnc:e.csrf_nonce})},parse:function(t){return t&&t.results?1===t.results.length?t.results[0]:t.results:t},idField:"id",callAPIMethod:function(i,n,s){n._nnc=e.csrf_nonce;var o=this.url()+"/"+i,r=this;t.post(o,n,function(t){var e=r.parse(t);r.set(e),s&&s(e)},"json")},modelName:"",getId:function(){return this.get(this.idField)},url:function(){var t=this.getId();return void 0!==t?e.Backbone.API_URL+this.modelName+"/"+t:e.Backbone.API_URL+this.modelName}}),e.Backbone.Collection=Backbone.Collection.extend({url:function(){return e.Backbone.API_URL+this.collectionName},parse:function(t){return t.results},collectionName:""});var i=Backbone.sync;Backbone.sync=function(t,n,s){"read"!==t&&(s=s||{},s.data=s.data||{},"delete"==t?(s.headers=s.headers||{},s.headers["X-Csrf-Token"]||(s.headers["X-Csrf-Token"]=e.csrf_nonce)):s.data=_.extend(s.data,{_nnc:e.csrf_nonce}),("create"==t||"update"==t)&&(s.data=_.extend(s.data,n.toJSON())),s.data=JSON.stringify(s.data),s.contentType="application/json"),i.call(this,t,n,s)}}(window.jQuery||window.Zepto,window.Etsy),"function"==typeof define&&define.amd&&define("etsy.backbone",[],function(){return window.Etsy.Backbone}),function(){window.Etsy=window.Etsy||{},Etsy.LoggingParams={getFromDOM:function(t){var e=$(t);if(e.length){var i=_.pairs(e.data());return _.reduce(i,function(t,e){var i=e[0];if("logging"==i.substring(0,7)){var i=e[0].substring(7).toLowerCase();t[i]=e[1]}return t},{})}return{}}}}(),define("etsy.loggingparams",[],function(){return Etsy.LoggingParams}),require({paths:{"collections/App":"collections/App.20161027161911"}},["jquery","collections/App"],function(t,e){var i=e.init();void 0===t&&Etsy.Logger.error("Unexpected missing jquery implementation"),t(document.body).on("etsy.listing.loaded",null,{},function(){i.initializeButtons()})}),"function"==typeof define&&define.amd&&define("bootstrap/collections/button",[],function(){});